
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Kubernetes Beginner Tutorial">
      
      
      
        <meta name="author" content="Bhavya Sree Bindela">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.0.1">
    
    
      
        <title>Controllers - Kubernetes Beginner</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.38780c08.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f72e892.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../css/pandas-dataframe.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Kubernetes Beginner" class="md-header-nav__button md-logo" aria-label="Kubernetes Beginner">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Kubernetes Beginner
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Controllers
            
          </span>
        </div>
      
    </div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/BhavyaSree/Kubernetes-Beginner" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    BhavyaSree/PythonClass
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Kubernetes Beginner" class="md-nav__button md-logo" aria-label="Kubernetes Beginner">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Kubernetes Beginner
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/BhavyaSree/Kubernetes-Beginner" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    BhavyaSree/PythonClass
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../02.kubernetes-concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../03.yaml/" title="YAML" class="md-nav__link">
      YAML
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../04.pods-with-yaml/" title="Pods" class="md-nav__link">
      Pods
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
    <a href="./" title="Controllers" class="md-nav__link md-nav__link--active">
      Controllers
    </a>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../06.deployments/" title="Deployments" class="md-nav__link">
      Deployments
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../07.networking/" title="Networking" class="md-nav__link">
      Networking
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../08.services/" title="Services" class="md-nav__link">
      Services
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../09.microservices/" title="Micro Services" class="md-nav__link">
      Micro Services
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../10.kubernetes-on-cloud/" title="Kubernetes on cloud" class="md-nav__link">
      Kubernetes on cloud
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Help
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Help" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        <span class="md-nav__icon md-icon"></span>
        Help
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Help/User-Guide/" title="User Guide" class="md-nav__link">
      User Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      Voting App
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Voting App" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        <span class="md-nav__icon md-icon"></span>
        Voting App
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Voting%20App/postgres-deploy/" title="Postgres deploy" class="md-nav__link">
      Postgres deploy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Voting%20App/postgres-pod/" title="Postgres pod" class="md-nav__link">
      Postgres pod
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Voting%20App/postgres-service/" title="Postgres service" class="md-nav__link">
      Postgres service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Voting%20App/redis-deploy/" title="Redis deploy" class="md-nav__link">
      Redis deploy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Voting%20App/redis-pod/" title="Redis pod" class="md-nav__link">
      Redis pod
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Voting%20App/redis-service/" title="Redis service" class="md-nav__link">
      Redis service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Voting%20App/result-app-deploy/" title="Result app deploy" class="md-nav__link">
      Result app deploy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Voting%20App/result-app-pod/" title="Result app pod" class="md-nav__link">
      Result app pod
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Voting%20App/result-app-service/" title="Result app service" class="md-nav__link">
      Result app service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Voting%20App/voting-app-deploy/" title="Voting app deploy" class="md-nav__link">
      Voting app deploy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Voting%20App/voting-app-pod/" title="Voting app pod" class="md-nav__link">
      Voting app pod
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Voting%20App/voting-app-service/" title="Voting app service" class="md-nav__link">
      Voting app service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Voting%20App/worker-app-deploy/" title="Worker app deploy" class="md-nav__link">
      Worker app deploy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Voting%20App/worker-app-pod/" title="Worker app pod" class="md-nav__link">
      Worker app pod
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      Yaml files
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Yaml files" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        <span class="md-nav__icon md-icon"></span>
        Yaml files
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../yaml-files/deployment/" title="Deployment" class="md-nav__link">
      Deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../yaml-files/nginx/" title="Nginx" class="md-nav__link">
      Nginx
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../yaml-files/pod/" title="Pod" class="md-nav__link">
      Pod
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../yaml-files/replicaset/" title="Replicaset" class="md-nav__link">
      Replicaset
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../yaml-files/service-definition/" title="Service definition" class="md-nav__link">
      Service definition
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Controllers</h1>
                
                <p>Controllers are the brain behind kubernetes.<br />
Controllers monitor the kubernetes objects and respond accordingly.   </p>
<h2>Replication Controller</h2>
<p>When we have a single pod running our application, if for some reason our application crashes and pod fails, the users will no longer be able to access our application.<br />
To prevent users from losing access to our application, we would like to have more than one instance or pod running at the same time. <br />
In this case, if one fails, we still have our application running on the other one.</p>
<p>The replication controller helps us to run multiple instances of a single pod in the kubernetes cluster thus providing high availability.</p>
<p>Even we have a single pod, replication controller can help by automatically bringing up the new pod when the existing one fails.<br />
Thus, the replication controller ensures that the specified number of pods are running at all time, even if it just 1 or 100.</p>
<h3>Load Balancing &amp; Scaling</h3>
<p>Another reason to have replication controller is to create multiple pods to share the load across them.<br />
When the number of users increase, we deploy additional pod to balance the load across the two pods. If the demand further increases and if we were run out of resources on the first node, we could deploy additional pods across the other nodes in the cluster.<br />
The replication controller spans across multiple nodes in the cluster. It helps us to balance the load across multiple pods on different nodes as well as scale our application when the demand increases.</p>
<h2>Replication Controller vs Replica set</h2>
<ul>
<li>Both have the same purpose but not the same.</li>
<li>Replication Controller is the older technology that is replaced by replica set.  </li>
<li>Replica set is the new recommended way to set up replication.</li>
</ul>
<h2>Create a replication controller</h2>
<div class="admonition example">
<p class="admonition-title">rc-definition.yml</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ReplicationController</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myapp-rc</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">front-end</span>
<span class="nt">spec</span><span class="p">:</span>
    <span class="c1"># template section to provide a pod template to be used by the replication controller to create replicas.</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myapp-prod</span>
      <span class="nt">labels</span><span class="p">:</span> 
        <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">front-end</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">containers</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx-container</span>
          <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>

  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
</code></pre></div>

</div>
<p><code>kubectl create -f &lt;filename&gt;</code>  <br />
This creates the replication controller. When the replication controller is created, it first creates the pods as pod definition template as many as required(3 in this case).</p>
<p><code>kubectl get replicationcontroller</code><br />
To view the list of created replication controllers.</p>
<p><code>kubectl get pods</code> <br />
To view the pods created by replication controller.</p>
<h2>Replica Set</h2>
<p>The role of the replica set is to monitor the pods and if any of them fails, it deploy new ones.
The replicaset is the process that monitor the pods.</p>
<div class="admonition example">
<p class="admonition-title">replicaset-definition.yml</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ReplicaSet</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myapp-replicaset</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">front-end</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myapp-prod</span>
      <span class="nt">labels</span><span class="p">:</span> 
        <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">front-end</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">containers</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx-container</span>
          <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>

  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="c1"># selector section helps replicaset identify what pods fall under it.</span>
  <span class="c1"># We need to mention this (though we have provided pod template) because, replicaset can also manage pods which are not created as part of the replicaset creation.</span>
  <span class="nt">selector</span><span class="p">:</span> 
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">front-end</span>
</code></pre></div>

</div>
<p>Selector is not required in the case of replication controller(still available, if not provided it assumes it to be the labels provided in the pod definition file), whereas a user input is required of this property in the case of replica set.</p>
<p><code>kubectl create -f &lt;filename&gt;</code><br />
To create a replica set<br />
<code>kubectl create -f replicaset-definition.yml</code>  </p>
<p><code>kubectl get replicaset</code><br />
To view the created replicasets</p>
<p>If we already have three pods created with matching labels on the kubernetes cluster and we need to select them as a replica set, still we need to provide the template property with the pod definition, as this pod definition will be used to build a new pod when any of the existing pods fails (to maintain the desired number of pods).</p>
<h3>Scale</h3>
<p>We started with 3 replicas and in future we decide to scale to 6. There are multiple ways to do this  </p>
<ol>
<li>update the number of replicas in the definition file to 6.
  <code>kubectl replace -f replicaset-definition.yml</code><br />
  This will update the replicaset to have 6 replicas</li>
<li><code>kubectl scale --replicas=6 -f replicaset-definition.yml</code> or <br />
<code>kubectl scale --replicas=6 replicaset myapp-replicaset</code> (type, name format, this won't change the number of replicas in the file).</li>
</ol>
<h2>Commands</h2>
<p><code>kubectl create -f replicaset-definition.yml</code>  <br />
To create replicaset using replicaset-definition.yml file</p>
<p><code>kubectl get replicaset</code><br />
To view the list replicasets created  </p>
<p><code>kubectl delete replicaset myapp-replicaset</code><br />
To delete the replicaset named myapp-replicaset.<br />
This also deletes all underlying PODs.  </p>
<p><code>kubectl replace -f replicaset-definition.yml</code><br />
To replace or update the replicaset</p>
<p><code>kubectl scale --replicas=6 -f replicaset-definition.yml</code> or<br />
<code>kubectl scale replicaset myapp-replicaset --replicas=6</code><br />
To scale replicaset simply by command line without modifying the file.  </p>
<p><code>kubectl edit replicaset myapp-replicaset</code> <br />
To view the running configuration of replicaset in a text format. This is not the actual file we created, this is a temporary file created by kubernetes to allow us to edit the configuration.<br />
Changes made to this file are directly applied on the running configuration of the cluster as soon as we change the file. <br />
This is mainly used to scale up or scale down.  </p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
      
    </div>
    
      <script src="../assets/javascripts/vendor.77e55a48.min.js"></script>
      <script src="../assets/javascripts/bundle.aa3f9871.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ['tabs'],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../javascripts/extra.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>